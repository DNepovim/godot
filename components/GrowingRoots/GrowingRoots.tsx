"use client";
import React, { ElementRef, useRef } from "react";
import { useWindowHeight } from "@react-hook/window-size";
import { theme } from "../../styles/theme";
import { paths } from "./paths";
import styled from "@emotion/styled";

const filledRoots = {
  d: "M891.92,126c8,19.17,13.19,50.59,37.18,45.21-21,8.18-33.75-17.19-38.43-34.35-2-7.3-5.17-12.41-8.88-15.94-10.24-5.38-19.86-11.23-28.12-16.41-30.73-19.47-68.13-15-97.95-5.22,5,8.75,14.55,16.41,31.07,18.45,23.86,3,60.41,15.56,53.6,46.94,2.84-39.52-52.8-35.17-77.73-46.17-7.89-3.45-12.85-9.52-16-16-6.67,2.58-12.8,5.26-18.23,7.91-9.41,5.58-5.44,8.68,2.45,11.17,35.52,10,67.31,28.09,79.56,63.78,17.5,51,43.08,97.56,73,128.85,7.34,1.1,15.36-.39,23.13-6.65,14.71-11.71,42.83-23.94,61.68,2-26.73-29.38-52.88,5.78-73.79,12.43a21.91,21.91,0,0,1-2.45.61c30.92,28.54,66,40.61,101.37,25.19-17.64,12.7-37,14.08-54.19,10.9,5.82,6.43,9,14.78,5.78,25.28,2.42-14.24-5.08-22-15.19-27.52a136.74,136.74,0,0,1-41.69-20.67s-13-7.73-29.83-24.46c2.85,14.35,3.2,31.43-4.46,46.76-.22.4-.46.83-.65,1.22,4.39,3.51,22.88,19.27,22.07,38.16-1,23.47-24.49,59.3,5.66,80.07-25.58-13.36-21.51-45.73-15-63.93,7.33-20.41-2.9-36.75-12.85-44.85-1.36-1.08-2.51-2.07-3.55-3C826.62,402.48,772.87,445.1,802.55,495c-30.19-38.16,1.77-88.31,24.42-115.75a84.36,84.36,0,0,0,13.28-22.48c-21,3.42-40.13,10.74-41.26,37.07-2.48-29.46,21.86-41.83,44.2-45.89,5.38-19.49,3.43-38.83-2.75-51.54-2.19-4.56-3.91-8.42-5.18-11.68a245.79,245.79,0,0,1-31.64-57c-24.78-63-52.09-85.52-118.9-87.49-12.17-.36-24.06-.94-35.71-1.82,13.94,8.4,28.73,21.35,34.06,40,.12.42.26.87.36,1.32,6.18-.66,32.68-2.67,45.68,11.76,16.15,17.88,22.82,61.36,62.59,54.4-30.69,9-50.76-17.64-58.56-35.73-8.76-20.33-29-24.75-43-23.4-1.85.2-3.55.35-5,.41,7.83,43.64-5.39,114.26,55,129-42.25-4.7-57-44.79-61.75-79.36-14,15.75-25.1,32.5-14.44,48.18-14.89-15.32-1.34-39,13.53-55.89-.55-5.46-.88-10.72-1-15.54-1.34-36.61-26.81-63.09-48.89-70.49-13.72-4.61-20.85-8.3-24.28-10.47a248.52,248.52,0,0,1-37.85-10.07c.88,1.15,1.82,2.31,2.87,3.49,12.52,13.55,35.42,35.23,13.78,70.89,24.82-50.64-40-82.41-43.48-86.35-6.93-4.82-7.28-5.69-14.07-9.11-16.46-10.24-9.63,1.92-7.75,30.76,4.49,45.23-.13,58.44,33.66,94,23.67-6.49,59.31-7.36,66.15,26.64-9.67-28.54-35.17-25-59.33-19.67,1.35,1.36,2.78,2.76,4.28,4.18,16.2,15.68,35.27,19.46,45.67,53.6,11.43,5.31,47.66,24.83,53.82,60.21.08.45.15.95.21,1.44,6.18-.2,32.51,0,44,16.48.34.46.62.91.93,1.39,16.62-1.79,37.86,1.69,40.4,24-4.76-19.42-21-20-37.26-18.34,11.11,22.47,16.84,59.83,52.62,56.33-31.09,6.92-48.41-23.2-54.45-43.12-6.77-22.41-26.34-28.88-40.3-28.63h-5c3.69,47.13-15.85,121.09,42.39,142-38.25-8-50.35-46.33-53.13-81.54-11.8,13.66-19.36,28.92-8.61,47.16-15.17-19.32-5.35-41.15,8.06-57-.28-8.31-.13-16.24.26-23.32,2.11-39.09-20.57-69.49-41.72-79.29l-3.09-1.5c-2.69,18.86-10.66,41.2-19.12,64.63l.42.35c3.37,29.29-1.77,73.68,32.44,77.05-31.09,1.65-38.47-37.23-38.25-62.34-12.35,34.74-23.46,70.64-18.22,100,14.44,80.8,125.21,81,125.21,81s-29.25,6.66-75.68-10c4.69,16.73-9,50,25.47,53.33-28.31.15-29.31-20.34-30.62-38.88-.62-9-2.34-15.18-7.51-19.47-12.48-5.69-25.71-16.82-36.08-32.06-2.18,10.7-7.43,22.4-18.89,31.51-.34.24-.66.48-1,.73,3.1,3.59,15.72,19.34,8.86,33.2C544.88,603.48,510.89,625,533.12,647c-20.23-15.57-6-38.7,6.1-50.78,13.59-13.57,9-28,2.07-36.18-.91-1.07-1.72-2.06-2.42-3-33.68,22.27-98.78,42.16-86.38,85.71-16.6-35,30-65.23,60.51-80.63,1.85-.94,3.62-1.88,5.3-2.91-10.71,1.72-21.27-1-27.24-13.53,11.07,17,27.25,10.23,42.47,2,15.18-14.52,21-32,19-44.18-.45-2.95-.8-5.49-1-7.74-8.21-22.39-10.25-49.47-.33-78.91,12.24-36.55,26.11-73.17,28.28-99.73-12.46,1.61-22.77,7.26-26,23.44,1.3-17.69,12.89-25.91,26.32-29.06-1.24-30-35-44.76-39-46.52-5.16-.93-8.88,9.42-9.58,19.09-.85,25.28-7.32,69.86-40.59,91.94-.55.34-1.14.67-1.68,1.05,4.23,8.34,21.09,44.66,7.91,69-.44.79-.88,1.53-1.38,2.29.5,8.43,3.86,15.85,12.65,21.11-8.45-3.5-13.05-9.85-15.15-17.36-19.08,25.95-60.43,39.45-31.77,88.53-28.82-39.1-9.35-62.4,11.72-81,23.69-20.89,19.13-51.14,9.76-70.2-1.24-2.52-2.32-4.81-3.28-6.88-22.88,11.91-53.7,20.84-81.56,33.27a28.74,28.74,0,0,0,1.77,13.65c4.74,13.05,14.36,34.78-9.84,52,26.39-26.5,1.07-45.13-1.9-61C351.2,438.62,301,532.82,311.18,597.94c-3.35-15.24-3.68-32-1.59-49.12a30,30,0,0,1-14.73,11.23c7.72-4,13.13-12.8,16.32-21.69.93-5.24,2.06-10.49,3.44-15.75v-.47l0,.29c16.19-63,61.28-124.82,110-136-22.43-7.37-46.46-13.65-57.86,12.47,9.51-32.78,45.9-26.37,67.23-17.29.64.27,1.21.4,1.83.66l2.15-.77c50.38-17.3,73-52.23,71.45-94.17-.51-13.76,2.12-36.21,2.79-42.89-9.31-9.83-14.05-15.19-20.69-29.64-.92,2.65-6.9,6.87-8.75,8.88-14.84,15.84-56.29,21.18-49.69,74.42-10.63-35.39,9.59-55.5,28.34-69.14,11-8,23.31-18.55,23.49-30.63-8.33-23.87-15-56.23-15.33-86.79-7.85,7.95-19.81,21.36-29.45,28.25,3.18,21.19,1,48.27-22.39,53.42,20.36-7.8,19.68-28.63,16.52-49.37a266.83,266.83,0,0,1-65.4,32,.47.47,0,0,1-.3.1c-5.86,2.07-8,5.13-8.82,8.91,0,20.63-1.67,53.68-10,85.18,8.08,27.95,12.28,69.19,45.15,65-30,8.54-44.46-27.62-49-52.23-6.29,18.77-15.2,36.3-28.16,49.38-.41.4-.88.77-1.31,1.15,3.69,5.17,18.53,28.09,8.66,49.16-12.3,26.11-57.52,59.83-30.92,91.64-24.6-22.2-4.45-57.43,12-76.09,18.49-20.94,13.81-42.19,5.63-54.1-1.11-1.61-2-3-2.87-4.34-26.58,20.69-72.06,45.37-101.8,84.85-3.14,8.24-3.39,17.55,1.22,28.39a39.13,39.13,0,0,1-5.82-22c-17.8,26.13-28.46,58.42-23.1,99.71-15.1-66.1,25.14-127,55.35-152.51-22.21-1.7-54.36-13.08-62.23,15.72,3.7-27.13,34.2-27.17,52.76-22.9,7.89,1.77,14.37,1.08,19.65-1,10.54-8.15,21.18-15.41,30.47-21.48C310.11,325.8,326,283,332.94,245.5c-10.89.68-20.26,5.62-32,21.57-17.79,24.17-49,58.81-74.58,34.53,35.39,24.4,61.09-32.72,83.22-55.58C317,238.3,327.1,233.87,334.83,234c3.14-21.92,3.27-40.85,2.63-51-.34.07-.71.1-1.06.14-43.35,4.12-88.29,6-124.63,27.23-22.25,22.43-41.57,47.64-23.08,79-14.55-18.45-13.08-38.53-4.76-56.61-1.13,1.22-2.24,2.46-3.32,3.75-22.89,27-39.37,64.54-53.65,98.29a35.09,35.09,0,0,0,8.46,29.34c12.59,14.36,27.3,43.11,5.52,66.38,24-32.15-11.65-56-20.32-77.68-.2-.42-6.1,16.55-6.24,16.11-4,10.35-2.45,5.19-5.22,12.42-17.14,45-44,55.24-44,55.24s26.33-16.36,37-56.44c7.31-27.27,16.81-62,32.28-100.43-7.28,5.06-15.66,8.72-24.76,8.68-.31,0-4.19,15.75-4.56,15.75-3.11,8.51-5.5,14.72-15.32,18.42C72.6,329,41.59,326.57,37.16,360.36c.85-26.91,24.18-36.89,38.66-39,16.28-2.32,24.09-17.67,26.41-29.32.31-1.55.61-3,.89-4.18C70.74,284,24.41,256.73,0,302.17c14.42-36.31,50.94-35.81,77.13-30-7.83-7.14-12.64-16.95-8.84-29.69-3.2,19.33,10.48,27.54,25.34,33.6,21.39,3.13,40.92-7.74,51.27-20.94a124.93,124.93,0,0,1,13.65-23.44c24-31.82,28.8-34.69,68.92-52.41-11.42-2.15-22.92-6.77-32.88-15.49-.4-.35-.84-.75-1.22-1.14-5.1,5.1-27.6,25.93-49.2,20.38a51.48,51.48,0,0,1-6-2c-13.68,10.93-34.61,20.47-47.22,1.85,13.07,14.58,27.69,5.87,41.26-4.52-24.94-12-55-37-81.58-6.7,21.37-31,57.67-17.92,77.11-4.92,21.84,14.64,43.08,4.84,54.77-6.56,1.54-1.5,2.94-2.8,4.27-4-37-39.15-73.51-120.91-137.94-93.12,51.1-31.18,101.4,23.26,127.71,59.94s67.35,45.64,92.28,37.56c11.46-3.69,19.28-5.32,24.46-6,30.61-10.25,59.8-19.1,81.86-28.4l-.44,0c-22.06,2.87-46,1.8-65.1-9.6-.38-.24-.75-.58-1.13-.8-2.69,4.42-14.94,22.77-32.25,19.92-21.45-3.55-56.73-32.78-72.19-2.23,9.19-26.37,39.13-18.59,56.43-9.62,19.43,10.13,33.12.71,39.36-9.26.85-1.34,1.62-2.47,2.3-3.52-36-28.65-81-91.41-122.94-64.41,21.51-19.81,51.24-6.65,76.89,12.14-4.53-19.12-4.83-49-27.06-48.17C249,6.77,256.83,32.38,258.65,49c.8,7.08,3,12.34,5.76,16.27,8.41,6.73,16.24,13.78,22.92,20,24.8,23.24,59,25.58,87,21.72-3.31-9-10.78-17.65-25.23-22.39-21-6.92-52-24.81-41.53-52.61-8,36,42.42,41.62,63.21,56.07,6.57,4.56,10.19,11,12.11,17.52,2.18-.46,17.7-1.87,18.48-2.51a98.36,98.36,0,0,1,11.32-.29,162.84,162.84,0,0,0,26.21-31.18c2.47-4.29,5.11-8.74,7.47-12.86-7.54,5.08-16.42,6.72-26.39,1.57C436.56,66,446.76,55.89,454.7,42c3.72-9.18,4.62-21.26,4.4-36.28,0-.76,0-2.84,0-5.69H518.5c-.15,5.71-.27,9.27-.27,9.9-.05,1.7,0,3.2,0,4.52a5.3,5.3,0,0,0-.06.77c0,.46.06.88.07,1.3a33.49,33.49,0,0,0,.57,6.24c2.11,18.52,21.25,33.48,29.33,41.22,6,5.47,12.64,11,19.58,16.17,31.36,10.36,61.84,13.66,82-12.17C637,91,612.49,95.51,586.53,92.41a38.87,38.87,0,0,0,7.53,4,91,91,0,0,0,20,7c17.13,3.6,40.38,4.66,68.59,8.61l3.58-.84A284.43,284.43,0,0,1,726.65,89a2.16,2.16,0,0,1,.12-.53c3.8-21.9,16.52-54.9,43.52-47.32-24.32-3-30.88,22-36.54,44.74,27.37-11.38,61.94-20.19,90.64-9.86.46.17.92.42,1.4.63,1.64-4,8-17.48,19.35-24,6.46-15.13,18.44-31,35.5-23.35-15-4.22-22.9,7.13-28.86,20.65a24.88,24.88,0,0,1,5.73-.88c23.85-.61,66.93,23,78.73-12.27-5.7,29.63-39.45,27.5-59.68,21.57-22.71-6.7-36.09,6-41.22,17.75-.7,1.56-1.36,2.93-2,4.16,43.78,22.88,102.76,79.84,144,42.87C957.18,148.33,922.81,140.5,891.92,126Z",
};

const defaultStrokeDashOffset = 1800;

export const GrowingRoots: React.FC<{
  offset: number;
}> = () => {
  const containerRef = useRef<ElementRef<"div">>(null);
  const bouding = containerRef.current ? containerRef.current.getBoundingClientRect() : undefined;
  const windowHeight = useWindowHeight();

  const newOffset = bouding
    ? defaultStrokeDashOffset - defaultStrokeDashOffset * ((bouding.top * -1 + windowHeight * 0.75) / (windowHeight / 2))
    : defaultStrokeDashOffset;

  return (
    <Centered ref={containerRef}>
      <Svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 993.41 647">
        {paths.map((path, i) => (
          <Path
            key={i}
            strokeDashOffset={newOffset > defaultStrokeDashOffset ? defaultStrokeDashOffset : newOffset < 0 ? 0 : newOffset}
            {...path}
          />
        ))}
        <FilledPath {...filledRoots} opacity={bouding ? 1 - bouding.top * 0.01 + 2 : 0} />
      </Svg>
    </Centered>
  );
};

const Svg = styled("svg")`
  width: 100% !important;
  height: auto;
  max-width: 500px;
  max-height: 340px;
  user-select: none;
`;

const Path = styled.path(
  (props: { strokeDashOffset: number }) => `
  stroke-dashoffset: ${props.strokeDashOffset};
  stroke-dasharray: ${defaultStrokeDashOffset};
  stroke: ${theme.color.yellow};
  fill: none;
  opacity: 0.7;
`
);

const FilledPath = styled.path(
  (props: { opacity: number }) => `
    display: none;
    opacity: ${props.opacity};
    fill: ${theme.color.lightBrown};
  `
);

const Centered = styled.div`
  text-align: center;
`;
